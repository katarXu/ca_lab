

# 计算机体系结构Lab4



<p align="right">PB18000334 徐家恒</p>

## 实验目标

1. 实现BTB（Branch Target Buffer）和BHT（Branch History Table）两种动态分支预测器
2. 体会动态分支预测对流水线性能的影响



## 实验环境

* **实验工具**：Vivado
* **实验方式**：Vivado自带的波形仿真



## 实验要求

* BTB
  * 我们要实现的BTB本质可以理解为是1bit预测器，如果上次这条分支指令跳转，那么这次它也跳转；如果上次不跳，那么这次也不跳
  * BTB实现一个buffer，保存当前地址高位、目标地址和有效位，类似于直接映射的cache，可以直接使用reg实现buffer
  * **buffer 放在取指阶段**，buffer内容读取一个周期内可以完成
  * BTB的命中：当前指令的地位用于寻址，对比指令的高位和buffer中是否相等并且有效位为1，表示命中，则下一条指令的地址不是pc+4，而是buffer中的内容
  * 在IF阶段是否命中信息会随着流水线段寄存器传递到EX阶段，根据实际是否跳转和IF阶段是否命中信息，**在EX阶段对buffer进行修改**
* BHT
  * BHT 首先要实现一个N\*2的buffer，N为大小，2表示2bit预测
  * 实现一个状态机
  * 用BHT来控制是否跳转（BTB不命中，BHT命中该如何处理？），BHT的根据状态机更新，BTB的更新与之前不同

## 实验内容

### 快速排序

![1](C:\Users\xujh2649\Desktop\workspace\ustc_ca2021_lab\lab4\1.png)

### 矩阵乘法

![image-20210612132215672](C:\Users\xujh2649\AppData\Roaming\Typora\typora-user-images\image-20210612132215672.png)





BTB不命中，BHT命中时，有跳转指令，但无跳转地址，仍不会跳转